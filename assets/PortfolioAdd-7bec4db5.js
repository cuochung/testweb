import{b as v,o,i as ee,w as D,c,a as t,t as P,g as N,T as j,h as L,D as R,L as K,F as J,K as E,n as I,e as w,I as Z,E as te,M as se,j as b,N as le,y as G,O as z,J as ae,P as F,Q as oe,S as ne,x as ie,U as re}from"./vendor-6e9e6359.js";import{P as A}from"./PDDInput-8aa94a7f.js";import{_ as ue,u as Q}from"./index-06443e34.js";const ce={class:"dialogContent"},de=t("div",{class:"icon"},[t("i",{class:"fa-solid fa-circle-exclamation"})],-1),q={__name:"PDDConfirm",setup(V,{expose:a}){const g=v(!1),_=v("刪除確認"),k=v("確認要刪除嗎??");let f,$;const p=(s=null)=>(s!=null&&(s.title&&(_.value=s.title),s.message&&(k.value=s.message)),g.value=!0,new Promise((i,h)=>{f=i,$=h})),e=()=>{g.value=!1,f(!0)},n=()=>{g.value=!1,$(!1)};return a({confirm:p}),(s,i)=>(o(),ee(j,{name:"pulse"},{default:D(()=>[g.value?(o(),c("div",{key:0,class:"dialog",onClick:n},[t("div",ce,[de,t("h2",null,P(_.value),1),t("p",null,P(k.value),1),t("div",{class:"buttons"},[t("button",{onClick:n},"取消"),t("button",{class:"accept",onClick:e},"確認")])])])):N("",!0)]),_:1}))}};const me={class:"PDDDataIterator"},pe={class:"footer"},ve={class:"pageNation"},ge=["onClick"],fe={key:1,class:"space"},he={class:"flex items-center text-white"},_e={class:"ml-2"},ye={__name:"PDDDataIterator",props:{items:{type:Array,default:[]},itemsPerPageOptions:{type:Array,default:[10,20,30]},itemsPerPage:{type:Number,default:10}},setup(V){const a=V;L(()=>{e.value.itemsPerPage=a.itemsPerPage});const g=v("slideRight"),_=v(""),k=R(()=>a.items.filter(n=>JSON.stringify(n).includes(_.value))),f=v([]),$=R(()=>{f.value=[];let n=k.value.filter((s,i)=>{let h=(e.value.page-1)*e.value.itemsPerPage,T=(e.value.page-1)*e.value.itemsPerPage+Number(e.value.itemsPerPage)-1;if(e.value.start=h,e.value.end=T,i>=h&&i<=T)return s});return n.forEach((s,i)=>{setTimeout(()=>{f.value[i]=!0},i*200)}),n}),p=R(()=>{let n=Math.ceil(k.value.length/e.value.itemsPerPage),s=[],i=7;if(n<7&&(i=n),n<=i){for(let h=1;h<=i;h++)s.push(h);return s}return e.value.page<=3?["1","2","3","4","...",String(n)]:e.value.page>=n-2?["1","...",String(n-3),String(n-2),String(n-1),String(n)]:["1","...",String(Number(e.value.page)-1),String(e.value.page),String(Number(e.value.page)+1),"...",String(n)]}),e=v({itemsPerPage:10,page:"1"});return v(!1),K(()=>p.value,n=>{let s=JSON.parse(JSON.stringify(n));s=s.pop(),Number(e.value.page)>Number(s)&&(e.value.page=s)}),(n,s)=>(o(),c("div",me,[t("div",pe,[t("div",ve,[t("i",{class:"fa-solid fa-angle-left",onClick:s[0]||(s[0]=i=>{Number(e.value.page)>1&&String(e.value.page--),g.value="slideLeft"})}),(o(!0),c(J,null,E(w(p),i=>(o(),c("div",null,[i!="..."?(o(),c("div",{key:0,class:I(["page",e.value.page==i?"active":""]),onClick:h=>e.value.page=i},P(i),11,ge)):(o(),c("div",fe,P(i),1))]))),256)),t("i",{class:"fa-solid fa-angle-right",onClick:s[1]||(s[1]=i=>{Number(e.value.page)<Number(JSON.parse(JSON.stringify(w(p))).pop())?String(e.value.page++):String(w(p)),g.value="slideRight"})})]),t("div",he,[t("div",null,P(Number(e.value.start)+1)+" - "+P(Number(e.value.end)+1>a.items.length?a.items.length:Number(e.value.end)+1)+" / 共 "+P(a.items.length)+" 筆 ",1),t("div",_e,[Z(" 每頁 "),te(t("select",{class:"item-per-page text-black","onUpdate:modelValue":s[2]||(s[2]=i=>e.value.itemsPerPage=i)},[(o(!0),c(J,null,E(V.itemsPerPageOptions,i=>(o(),c("option",null,P(i),1))),256))],512),[[se,e.value.itemsPerPage]]),Z(" 筆 ")])])]),N("",!0),b(j,{name:g.value,mode:"out-in"},{default:D(()=>[le(n.$slots,"default",{matchItems:w($),page:e.value.page,showItem:f.value},void 0,!0)]),_:3},8,["name"]),N("",!0)]))}},ke=ue(ye,[["__scopeId","data-v-ac9e4173"]]);const be={class:"imgControlerSlider text-white"},we={key:0,class:"imageBox color-4Transparent p-2 flex justify-center items-center fixed top-0 right-0"},xe={class:"w-full"},Pe={class:"imageBoxTitle flex justify-between pr-5"},$e={key:0,class:"flex"},Ce={ref:"form",class:"ml-2"},Se={class:"flex items-center"},Ne=t("div",{class:"animate-bounce mr-3"},"上傳作業中...",-1),Te={key:1,class:"searchSection"},Ve={class:"imageBoxContent mt-2"},De={key:0,class:"imgPreviewZone flex flex-wrap py-1"},Ie=["keys"],Oe=["src"],Me=["onClick"],Re={key:1},Je=["onClick"],je={class:"flex justify-center items-center w-5 h-5 rounded-full bg-black ring-2 ring-white absolute top-1 right-1 cursor-pointer"},Ue=["onClick"],Ye=["src"],Be={__name:"imgControlerSlider",setup(V){const a=Q(),g=G("$api"),_="border-1 border-white p-2 rounded hover:text-black hover:bg-white hover:-translate-y-1 hover:scale-110 duration-500",k=v(),f="imgcontroler",$=v([]),p=v(!1),e=v({}),n=v(""),s=v([]),i=v([]),h="\\S::不可空白唷",T=v(""),U=R(()=>{let d=T.value.split(" "),l="";return d.reduce((u,y)=>u.filter(C=>{if(l=JSON.stringify(C).toUpperCase(),l.includes(y.toUpperCase()))return C}),$.value)});L(()=>{O()});const O=()=>{g.get(f).then(d=>{$.value=d.map(l=>({...JSON.parse(l.datalist),snkey:l.snkey})).sort((l,u)=>l.snkey<u.snkey?1:-1)})},S=async d=>{k.value.confirm().then(async u=>{console.log("rs",u),d.delInfo={time:F().format("YYYY-MM-DD HH:mm:ss")};let y={snkey:d.snkey,tablename:"imgcontroler",datalist:JSON.stringify(d)};await g.delete(y.tablename,y).then(C=>{console.log(C),C.state&&(a.showToast({type:"success",message:"已刪除",closeTime:2}),O())}),await g.options(`general/delPic/${y.tablename}/${d.picName}`).then(C=>{console.log(C)})}).catch(u=>{console.log("err",u)})},r=d=>{let l=`${a.state.base_url}/upload/${f}/${d.picName}`;navigator.clipboard.writeText(l).then(()=>{a.showToast({type:"success",message:"您已成功複製內容",closeTime:2})})},m=d=>{let l=d.name.split(".").pop().toLowerCase(),u=["gif","png","jpg","jpeg"],y="";return u.indexOf(l)==-1&&(y+="檔案:"+d.name+"不是支持的影像檔案"),d.size>1024*1024*5&&(y+="檔案:"+d.name+"不能超過5M唷"),y==""?!0:y};let Y=R(()=>s.value.map(d=>URL.createObjectURL(d)));const B=d=>{Object.values(d.target.files).forEach(l=>{let u=m(l);u==!0?s.value.push(l):a.showToast({type:"warning",message:u,closeTime:2})}),d.target.value=""},W=d=>{s.value.splice(d,1)},X=async()=>{if(!s.value)return a.showToast({type:"warning",message:"未選擇任何檔案",closeTime:3}),!1;if(!e.value.name)return a.showToast({type:"warning",message:"未輸入標題",closeTime:3}),!1;const d=new FormData;s.value.forEach(l=>{d.append("files[]",l)}),await g.upload(f,d).then(l=>{console.log("rs",l),l.filter(x=>x.error).length&&a.showToast({type:"warning",message:"上傳檔案過程有誤,請查看console",closeTime:5});let C=l.filter(x=>x.success).map(x=>{let M={title:e.value.name,picName:x.success,picOriginalName:x.picOriginalName,createTime:F().format("YYYY-MM-DD HH:mm:ss")};return{datalist:JSON.stringify(M)}});g.addMulti(f,C).then(x=>{x.filter(H=>!H.state).length?a.showToast({type:"error",message:"多筆存入過程有誤",closeTime:5}):(s.value=[],a.showToast({type:"success",message:"已上傳",closeTime:2}),O())})})};return(d,l)=>(o(),c("div",be,[t("input",{type:"file",accept:"image/*",ref_key:"fileInput",ref:n,multiple:"",onChange:B,style:{display:"none"}},null,544),b(q,{ref_key:"pddconfirm",ref:k,style:{"z-index":"1000"}},null,512),t("div",null,[t("button",{class:I(_),onClick:l[0]||(l[0]=u=>p.value=!0)}," 圖片管理 "),b(j,{name:"slide-right",mode:"out-in",appear:""},{default:D(()=>[p.value?(o(),c("div",we,[t("div",xe,[t("div",Pe,[t("button",{onClick:l[1]||(l[1]=z(u=>{d.$refs.fileInput.click()},["prevent"])),class:I(_)},"上傳圖片"),w(Y).length?(o(),c("div",$e,[t("form",Ce,[t("div",Se,[Ne,b(A,{otherInputClass:"bg-transparent text-white",ref:u=>i.value.push(u),labelVal:"標題",rules:h,modelValue:e.value.name,"onUpdate:modelValue":l[2]||(l[2]=u=>e.value.name=u)},null,8,["modelValue"]),t("button",{class:I([_,"ml-2"]),onClick:l[3]||(l[3]=z(u=>X(),["prevent"]))},"確認上傳圖片 ("+P(s.value.length)+")",1)])],512)])):(o(),c("div",Te,[b(A,{otherInputClass:"bg-transparent text-white",typeSet:"search",ref:u=>i.value.push(u),labelVal:`搜尋...[${w(U).length}]`,modelValue:T.value,"onUpdate:modelValue":l[4]||(l[4]=u=>T.value=u)},null,8,["labelVal","modelValue"])])),t("i",{class:"fa-solid fa-xmark text-2xl cursor-pointer mt-4",onClick:l[5]||(l[5]=u=>p.value=!1)})]),t("div",Ve,[t("div",null,[s.value.length?(o(),c("div",De,[(o(!0),c(J,null,E(w(Y),(u,y)=>(o(),c("div",{keys:y,class:"m-1 relative"},[t("img",{src:u,alt:"",class:"h-30"},null,8,Oe),t("i",{onClick:C=>W(y),class:"fa-solid fa-xmark p-1 rounded-full bg-black ring-2 ring-white absolute top-1 right-1"},null,8,Me)],8,Ie))),256))])):(o(),c("div",Re,[b(ke,{items:w(U),itemsPerPageOptions:[10,20,30],itemsPerPage:10},{default:D(({matchItems:u,page:y,showItem:C})=>[(o(),c("div",{class:"imgControlerZone flex flex-wrap gap-3 py-5 relative overflow-auto",style:{height:"83vh"},key:y},[b(ae,{name:"showList",appear:""},{default:D(()=>[(o(!0),c(J,null,E(u,(x,M)=>(o(),c(J,{key:M},[C[M]?(o(),c("div",{key:0,onClick:H=>r(x),class:"relative border-white border-1 rounded p-2"},[t("div",je,[t("i",{onClick:z(H=>S(x),["stop"]),class:"fa-solid fa-xmark"},null,8,Ue)]),t("img",{loading:"lazy",class:"h-30",src:`${w(a).state.base_url}/upload/${f}/${x.picName}`},null,8,Ye),t("div",null,P(x.title),1),t("div",null,P(x.picOriginalName),1)],8,Je)):N("",!0)],64))),128))]),_:2},1024)]))]),_:1},8,["items"])]))])])])])):N("",!0)]),_:1})])]))}};const Ee={__name:"PddCkeditor",props:["modelValue","readonlyModel"],emits:["update:modelValue"],setup(V,{emit:a}){const g=V,_=v(""),k=ne,f=v({placeholder:"訊息內容輸入區"});L(()=>{_.value=g.modelValue}),K(_,p=>{a("update:modelValue",p)});const $=p=>{g.readonlyModel&&(p.ui.view.toolbar.element.style.display="none",p.enableReadOnlyMode("ckeditor"))};return(p,e)=>{const n=oe("ckeditor");return o(),c("div",null,[b(n,{editor:w(k),config:f.value,onReady:$,modelValue:_.value,"onUpdate:modelValue":e[0]||(e[0]=s=>_.value=s)},null,8,["editor","config","modelValue"])])}}};const Ae={class:"PortfolioAdd"},Le={key:0,class:"TitleEditZone"},He={class:"editZoneTitle flex justify-between border-b-1 relative text-white"},ze={key:0},Fe={class:"text-2xl text-center font-bold"},Ze={class:"mt-5 flex items-center text-white"},Ke=t("i",{class:"fa-solid fa-xmark text-3xl"},null,-1),Ge=[Ke],Qe={key:0,class:"text-4xl font-bold text-white"},et={__name:"PortfolioAdd",setup(V){const a=Q(),g=ie(),_=re(),k=G("$api"),f="border-1 border-white p-2 rounded hover:text-black hover:bg-white hover:-translate-y-1 hover:scale-110 duration-500",$=v(),p=v("add"),e=v({}),n=v([]),s="\\S::不可空白唷";L(()=>{i()});const i=()=>{if(_.params.snkey){let S={key:"snkey",value:_.params.snkey},r=`general/getByKey/${a.state.databaseName}/data`;k.options(r,S).then(m=>{e.value={...JSON.parse(m[0].datalist),snkey:m[0].snkey},p.value="edit"})}},h=S=>{g.push("/main/"+S)},T=()=>{let S={datalist:JSON.stringify(e.value)};k.add("data",S).then(r=>{r.state&&(a.showToast({type:"success",message:"已新增",closeTime:2}),h("portfoliolist"))})},U=()=>{console.log("edit",e.value);let S={snkey:e.value.snkey,datalist:JSON.stringify(e.value)};k.post("data",S).then(r=>{console.log(r),r.state&&(a.showToast({type:"success",message:"已修改",closeTime:2}),h("portfoliolist"))})},O=()=>{$.value.confirm().then(r=>{console.log("rs",r);let m=e.value;m.delInfo={time:F().format("YYYY-MM-DD HH:mm:ss")};let Y={snkey:m.snkey,tablename:"data",datalist:JSON.stringify(m)};k.delete("data",Y).then(B=>{console.log(B),B.state&&(a.showToast({type:"success",message:"已刪除",closeTime:2}),h("portfoliolist"))})}).catch(r=>{console.log("err",r)})};return(S,r)=>(o(),c("div",Ae,[b(q,{ref_key:"pddconfirm",ref:$},null,512),w(a).state.logined?(o(),c("div",Le,[t("div",He,[p.value=="add"?(o(),c("div",ze)):(o(),c("i",{key:1,class:"fa-solid fa-trash text-2xl cursor-pointer",onClick:r[0]||(r[0]=m=>O())})),t("div",Fe,P(p.value=="add"?"新增":"修改")+"作品集",1),t("i",{class:"fa-solid fa-xmark text-2xl cursor-pointer",onClick:r[1]||(r[1]=m=>h("portfoliolist"))})]),t("div",Ze,[b(A,{class:"w-full",otherInputClass:"bg-transparent text-white",ref:m=>n.value.push(m),labelVal:"標題設定",rules:s,modelValue:e.value.title,"onUpdate:modelValue":r[2]||(r[2]=m=>e.value.title=m)},null,8,["modelValue"]),b(A,{class:"w-full ml-2",otherInputClass:"bg-transparent text-white",ref:m=>n.value.push(m),labelVal:"首張圖片設定",rules:s,modelValue:e.value.firstPic,"onUpdate:modelValue":r[3]||(r[3]=m=>e.value.firstPic=m)},null,8,["modelValue"]),b(Be,{class:"whitespace-nowrap ml-2"})])])):N("",!0),t("div",{class:"cursor-pointer fixed top-3 right-3 w-10 h-10 text-black bg-white hover:bg-black hover:text-white ring-black hover:ring-white ring-2 rounded-full flex justify-center items-center transition-all duration-500 z-100",onClick:r[4]||(r[4]=m=>h("portfoliolist"))},Ge),b(j,{name:"slide-right",appear:""},{default:D(()=>[w(a).state.logined?N("",!0):(o(),c("div",Qe,P(e.value.title),1))]),_:1}),b(j,{name:"slide-right",appear:""},{default:D(()=>[e.value.title?(o(),c("div",{key:0,class:I(["editZoneBody relative p-1 bg-gray-300 rounded shadow-light-500",w(a).state.logined?"":"mt-4"])},[b(Ee,{modelValue:e.value.content,"onUpdate:modelValue":r[5]||(r[5]=m=>e.value.content=m),readonlyModel:!w(a).state.logined},null,8,["modelValue","readonlyModel"]),p.value=="add"?(o(),c("button",{key:0,class:I([f,"mt-2 text-white float-right"]),onClick:r[6]||(r[6]=m=>T())},"確認新增存檔")):N("",!0),p.value!="add"&&w(a).state.logined?(o(),c("button",{key:1,class:I([f,"mt-2 text-white float-right"]),onClick:r[7]||(r[7]=m=>U())},"確認存檔")):N("",!0)],2)):N("",!0)]),_:1})]))}};export{et as default};
